window.App=window.App||{},App.Person={data:{},fetch:function(t){return m.request({method:"GET",url:"/results/person",data:t}).then(function(t){this.data=t}.bind(this))},save:function(t){window.console.log("save called");var n={wet_id:this.data.wet_id,route:this.data.route,grp_id:this.data.grp_id,start_order:this.data.start_order,result_json:t};return m.request({method:"PUT",url:"/results/person",data:n})}},window.App=window.App||{},App.MResult=function(t){this.id="p"+t,this.score=m.prop(0),this.bonus=m.prop(0)},App.MResult.prototype={parse:function(t){var n=t.match("t[0-9]{1,}")||null,e=t.match("b[0-9]{1,}")||null;n=n?parseInt(n[0].slice(1),10):null,e=e?parseInt(e[0].slice(1),10):null,this.result=t,this.score(n?[10,7,4][n-1]:0),this.bonus(n||e?1:0)},update:function(t){var n=parseInt(t,10),e=[10,7,4].indexOf(n),s=[10,7,4,1].indexOf(n),o=e>-1?n:0,i=s>-1?1:0;this.result=o?"t"+(e+1):i?"b1":null,this.score(o),this.bonus(i)}},window.App=window.App||{},App.MResult=function(t){this.id="p"+t,this.score=m.prop(0),this.bonus=m.prop(0)},App.MResult.prototype={parse:function(t){var n=t.match("t[0-9]{1,}")||null,e=t.match("b[0-9]{1,}")||null;n=n?parseInt(n[0].slice(1),10):null,e=e?parseInt(e[0].slice(1),10):null,this.result=t,this.score(n?[10,7,4][n-1]:0),this.bonus(n||e?1:0)},update:function(t){var n=parseInt(t,10),e=[10,7,4].indexOf(n),s=[10,7,4,1].indexOf(n),o=e>-1?n:0,i=s>-1?1:0;this.result=o?"t"+(e+1):i?"b1":null,this.score(o),this.bonus(i)}},window.App=window.App||{},App.VM=function(t,n){this.WetId=t||1,this.Route=0,this.perId=m.prop(null),this.name=m.prop(null),this.category=m.prop(null),this.result=m.prop(null),this.resArray=function(){for(var t=1,n=[];30>=t;t++)n.push(new App.MResult(t));return n}(),this.sumResults=function(){var t=0,n=0;this.resArray.forEach(function(e){t+=e.score(),n+=e.bonus()}),this.result(t+" / "+n)},this.parseModelData=function(t){this.perId(t.data.per_id),this.name(t.data.lastname+", "+t.data.firstname[0]),this.category(t.data.grp_id),this.result(t.data.result),this.resArray.forEach(function(n){var e=JSON.parse(t.data.result_json)[n.id];n.parse(e?e:"")}.bind(this))},this.composeURLParams=function(t){return{wet_id:this.WetId,route:this.Route,per_id:t}},this.fetch=function(t){var e=this.composeURLParams(t),s=n.fetch(e);s.then(function(){window.console.log(n.data);try{this.parseModelData(n)}catch(t){window.console.log(t)}}.bind(this)).then(function(){App.connectionStatus(!0)}).then(null,function(){App.connectionStatus(!1)})},this.serialiseResults=function(){var t={};return this.resArray.filter(function(t){return t.result}).forEach(function(n){t[n.id]=n.result}),JSON.stringify(t)},this.save=function(){var t=this.serialiseResults(),e;e=n.save(t),e.then(function(){App.connectionStatus(!0)}).then(null,function(){App.connectionStatus(!1)})}},window.App=window.App||{},App.VResult={controller:function(t){this.model=t.model,this.set=function(n){t.model.update(n),t.addFn()}},view:function(t){var n={ong:{view:function(){return m("span.flag.noerror",m.trust("&nbsp;"))}},onr:{view:function(){return m("span.flag.error",m.trust("&nbsp;"))}},off:{view:function(){return m("span.flag",m.trust("&nbsp;"))}}};return m(".tile",[m("span.bloc",t.model.id),m("input[type=text].textbox",{pattern:"[0-9]*",value:t.model.score()||t.model.bonus()||null,onchange:m.withAttr("value",t.set.bind(t))}),m.component(10===t.model.score()?n.ong:n.off),m.component(7===t.model.score()?n.ong:n.off),m.component(4===t.model.score()?n.ong:n.off),m.component(1===t.model.bonus()?n.ong:n.off)])}},window.App=window.App||{},App.VPerson={controller:function(t){this.vm=t},view:function(t){var n=t.vm;return m(".header",[m("span.bloc","PerId:"),m("input[type=text].textbox",{pattern:"[0-9]*",value:n.perId(),onchange:m.withAttr("value",n.fetch.bind(n))}),m("span#grpid",n.category()),m("span#name",n.name()),m("span#result",n.result())])}},window.App=window.App||{},App.VM=function(t,n){this.WetId=t||1,this.Route=0,this.perId=m.prop(null),this.name=m.prop(null),this.category=m.prop(null),this.result=m.prop(null),this.resArray=function(){for(var t=1,n=[];30>=t;t++)n.push(new App.MResult(t));return n}(),this.sumResults=function(){var t=0,n=0;this.resArray.forEach(function(e){t+=e.score(),n+=e.bonus()}),this.result(t+" / "+n)},this.parseModelData=function(t){this.perId(t.data.per_id),this.name(t.data.lastname+", "+t.data.firstname[0]),this.category(t.data.grp_id),this.result(t.data.result),this.resArray.forEach(function(n){var e=JSON.parse(t.data.result_json)[n.id];n.parse(e?e:"")}.bind(this))},this.composeURLParams=function(t){return{wet_id:this.WetId,route:this.Route,per_id:t}},this.fetch=function(t){var e=this.composeURLParams(t),s=n.fetch(e);s.then(function(){window.console.log(n.data);try{this.parseModelData(n)}catch(t){window.console.log(t)}}.bind(this)).then(function(){App.connectionStatus(!0)}).then(null,function(){App.connectionStatus(!1)})},this.serialiseResults=function(){var t={};return this.resArray.filter(function(t){return t.result}).forEach(function(n){t[n.id]=n.result}),JSON.stringify(t)},this.save=function(){var t=this.serialiseResults(),e;e=n.save(t),e.then(function(){App.connectionStatus(!0)}).then(null,function(){App.connectionStatus(!1)})}},window.App=window.App||{},App.connectionStatus=m.prop(!0),App.SuperVC={controller:function(){var t={WetId:1,Route:0,GrpId:6};this.Title="test",this.vm=new App.VM(t.WetId,App.Person)},view:function(t){var n=t.vm;return[m("h3.title",t.Title),m.component(App.VPerson,n),m("#tiles",[n.resArray.map(function(t){return m.component(App.VResult,{model:t,addFn:n.sumResults.bind(n)})})]),m("button",{onclick:n.save.bind(n)},"Submit")]}},m.mount(document.body,App.SuperVC);