_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},_.mixin({compareElements:function(e,t,i){for(var s=0;s<e[t].length&&s<e[i].length;){if(e[t][s]<e[i][s])return 1;if(e[t][s]>e[i][s])return-1;s++}return 0},quicksort:function(e,t,i){for(var s=t,n=i,r=t,l;n>=s;){for(;_.compareElements(e,s,r)>0;)s++;for(;_.compareElements(e,n,r)<0;)n--;n>=s&&(l=e[s],e[s]=e[n],e[n]=l,s++,n--)}n>t&&_.quicksort(e,t,n),i>s&&_.quicksort(e,s,i)},titleize:function(e){return null==e?"":String(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},strRight:function(e,t){if(null==e)return"";e=String(e),t=null!=t?String(t):t;var i=t?e.indexOf(t):-1;return~i?e.slice(i+t.length,e.length):e}}),window.App=window.App||{},App.Climber=Backbone.Model.extend({}),App.ClimberView=Backbone.View.extend({tagName:"li",initialize:function(){this.listenTo(this.model,"change",this.update,this)},render:function(){var e=$("#climber_template").text(),t=_.template(e,{name:_.titleize(this.model.get("name")),code:this.model.get("category").toUpperCase(),points:this.model.get("points"),bonus:this.model.get("bonus"),rank:this.model.get("rank")||this.model.get("perid")});return this.$el.html(t),this.$(".rank").addClass(this.model.get("category")),this.$el.data("rankorder",this.model.get("rank")),this},update:function(){this.$(".pts").text(this.model.get("points")),this.$(".bns").text(this.model.get("bonus")),this.$(".rank").text(this.model.get("rank")),this.$el.data("rankorder",this.model.get("rank"))}}),window.App=window.App||{},App.ResultsList=Backbone.Collection.extend({url:"./scripts/getJSON.php",model:App.Climber,initialize:function(e){this.cat=e.cat||"m"},loadResults:function(){var e=this.url+"?cat="+this.cat,t=$.Deferred(),i=$.getJSON(e),s=this;return i.success(function(e){s.reset(e),t.resolve(!0)}),i.error(function(){t.resolve(!1)}),t},update:function(){var e=this.url+"?cat="+this.cat,t=$.Deferred(),i=$.getJSON(e),s=this;return i.success(function(e){s.setResults(e),t.resolve(!0)}),i.error(function(){t.resolve(!1)}),t},setResults:function(e){var t;_(e).each(function(e){t=this.get(e.id),t.set({points:e.points,bonus:e.bonus,rank:e.rank})},this)}}),App.ResultsListView=Backbone.View.extend({$resultsView:null,currentView:null,className:"resultslistview",initialize:function(e){var t=this;t.loadResults(e.cat),setInterval(function(){t.updateView({force_refresh:!0})},5e3)},loadResults:function(e){var t,i,s=[],n=this;this.initViewContainer(e),_(this.resultslists).each(function(e){i=e.loadResults(),$.when(i).done(function(i){i&&e.each(function(e){t=new App.ClimberView({model:e}),n.climberviews.push(t),n.$resultsView.append(t.render().el),t.update()})}),s.push(i)}),$.when.apply(null,s).done(function(){n.$resultsView.isotope({itemSelector:"li",getSortData:{rankorder:function(e){return parseInt(e.data("rankorder"),10)}}}),n.updateView()})},initViewContainer:function(e){this.resultslists=[],this.resultslists.push(new App.ResultsList({cat:e})),this.render()},render:function(){var e="<ul></ul>";this.currentView&&this.close(),this.climberviews=[],this.$el.html(e),this.$resultsView=this.$("ul"),$("#wrapper").prepend(this.el),this.currentView=this},updateView:function(e){var t,i=[],s=this;e||(e={}),e.force_refresh&&_(this.resultslists).each(function(e){t=e.update(),i.push(t)},this),$.when.apply(null,i).done(function(){var e="visible";s.$resultsView.isotope("updateSortData",s.$("li")),s.$resultsView.isotope({sortBy:"rankorder"})})}});